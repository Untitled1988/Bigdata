## 开窗函数
### ROW_NUMBER()
为结果集中的每一行分配一个唯一的整数值，常用于对结果集进行编号。
```sql
SELECT ROW_NUMBER() OVER (ORDER BY column_name) AS row_num, column_name
FROM table_name;
```
### RANK()
根据指定的排序顺序，为结果集中的每一行分配一个排名，如果有相同值，则会跳过下一个排名
```sql
SELECT RANK() OVER (ORDER BY column_name) AS rank_num, column_name
FROM table_name;
```
### DENSE_RANK() 
根据指定的排序顺序，为结果集中的每一行分配一个密集排名，如果有相同值，则会跳过下一个排名，但不会留下空缺。
```sql
SELECT DENSE_RANK() OVER (ORDER BY column_name) AS dense_rank_num, column_name
FROM table_name;
```
### SUM()
```sql
SELECT column_name, SUM(column_name) OVER (PARTITION BY partition_column) AS total_sum
FROM table_name;
```
### AVG()
```sql
SELECT column_name, AVG(column_name) OVER (PARTITION BY partition_column) AS average_value
FROM table_name;
```
### 缓慢变化维
缓慢变化维是指在数据仓库中，用于存储维度数据的表，它的数据会随着时间的推移而发生变化，这种变化是缓慢的，而不是瞬间发生的。
- SCD Type 1（SCD1）：当维度数据变化时，直接覆盖原有数据，不保留历史记录。这种方法适用于不需要保留历史变化的情况，只关注当前状态的维度数据。新数据将完全替代旧数据。
- SCD Type 2（SCD2）：当维度数据发生变化时，保留原有记录，并添加新记录来反映变化。这样可以保留历史数据，以便进行时间分析和趋势分析。通常，在SCD2中，会添加一个生效日期和失效日期的列，用于标识每个版本的有效时间范围。
- SCD Type 3（SCD3）：在维度数据变化时，保留原有记录，并添加一些附加列来跟踪变化。通常，这些附加列用于存储先前的属性值，以便进行部分历史分析。SCD3相对于SCD2来说，对历史数据的保留更有限，只关注一些关键变化。

#### 假设我们有一个产品维度表，包含以下列：

- 产品ID（Product ID）
- 产品名称（Product Name）
- 产品类型（Product Type）
- 生效日期（Effective Date）
- 失效日期（Expiration Date）
#### 设计逻辑如下：
- `初始状态`：在数据仓库中加载初始产品维度数据，每个产品有唯一的产品ID，产品名称，产品类型等属性，同时设置生效日期和失效日期为空。

- `变化发生`：当产品维度数据发生变化时，例如产品名称的修改，需要进行以下步骤： 
  - 在维度表中查找具有相同产品ID的最新记录，检查其失效日期是否为空。如果失效日期为空，将其设置为当前日期，表示该记录不再有效。
  - 创建一条新的记录，拷贝原有记录的产品ID，产品类型等属性，并更新产品名称为新值，同时设置生效日期为当前日期，失效日期为空。
  - 历史记录保留：通过保留历史记录，我们可以跟踪产品名称的变化。在维度表中，会存在多个具有相同产品ID的记录，但生效日期和失效日期不同。这样，我们可以根据需要进行历史数据查询和分析。

#### 举个例子：
假设有一个产品ID为 "P001" 的产品，在初始状态下，产品名称为 "Product A"，类型为 "Type 1"。后来，产品名称变更为 "Product A Updated"。根据SCD2的设计逻辑，我们会进行如下操作：
- 在维度表中查找产品ID为 "P001" 且失效日期为空的记录，假设该记录的生效日期为 "2022-01-01"。
- 将该记录的失效日期设置为 "2022-05-01"，表示该记录在 "2022-05-01" 不再有效。
- 创建一条新记录，拷贝产品ID、类型等属性，并将产品名称设置为 "Product A Updated"，生效日期设置为 "2022-05-01"，失效日期为空。
通过这种方式，我们可以在数据仓库中保留历史产品名称的变化记录，同时提供了当前有效的产品信息。这样，我们可以根据需要进行历史数据分析和趋势分析，同时保持维度数据的一致性和准确性。

### 事实表
事实表（Fact Table）是数据仓库中的一种关键表格，用于存储与业务事实和度量相关的数据。事实表包含了多个度量（Measure）列和与其关联的外键列，用于与维度表建立关联。
#### 以下是事实表的一些特点和设计要点：
- `存储度量数据`：事实表存储了与业务过程、事件或交易相关的数值型度量数据，例如销售金额、订单数量、库存量等。这些度量数据是可以被聚合和分析的关键指标。
- `外键关联维度表`：事实表通过外键与一个或多个维度表进行关联。这些外键通常是指向维度表中的主键列，用于连接事实表和维度表，以提供更多的上下文信息和分析维度。
- `粒度（Granularity）`：事实表的粒度是指每个事实记录所代表的业务事件或事实的详细程度。粒度决定了事实表的行数和存储的详细程度。例如，销售事实表可以以每个订单为粒度，或者更细粒度地以每个订单行为粒度。
- `聚合层次`：事实表可以包含多个层次的度量数据，从较粗粒度的聚合数据到更细粒度的原始数据。这样可以支持不同层次的分析和报表需求，提供灵活性和性能优化。
- `时态数据`：某些情况下，事实表还可以存储时态数据，即描述时间的变化。例如，销售事实表可以包含销售日期列，以支持时间维度的分析和趋势分析。
- `可更新性`：事实表通常是一个只读的表，用于存储历史数据，不会频繁更新。数据仓库中的ETL过程负责将源系统的数据转换和加载到事实表中。
事实表的设计和建模需要考虑业务需求、分析要求和性能优化等因素。它提供了与维度表关联的度量数据，为数据仓库用户提供了丰富的分析能力，支持业务决策和洞察力的提升。

### 维度表
（Dimension Table）是数据仓库中的一种关键表格，用于存储与业务实体相关的描述性属性。维度表包含了维度属性列和与其关联的主键列，用于与事实表建立关联。
#### 以下是维度表的一些特点和设计要点：
- `存储描述性属`性：维度表存储与业务实体相关的描述性属性，例如产品、客户、时间等。这些属性用于提供上下文信息，帮助解释和分析事实表中的度量数据。
- `主键列`：维度表中的主键列是唯一标识每个维度实体的列。主键用于与事实表中的外键建立关联，实现维度和事实之间的关系。主键通常是一个稳定的标识符，不随时间或其他变化而改变。
- `描述性属性列`：维度表包含了描述性属性列，用于存储与维度实体相关的属性信息。例如，产品维度表可以包含产品名称、产品类型、制造商等属性列。这些属性提供了对维度实体的详细描述和分类。
- `层次结构`：维度表可以包含多个层次结构，用于提供维度数据的不同层次视图。例如，时间维度表可以包含年、季度、月份、日期等层次结构，以支持不同层次的时间分析和聚合。
- `可选属性和衍生属性`：维度表可以包含可选的属性列，用于提供更多的维度信息。此外，还可以包含衍生属性，这些属性是通过计算或转换从原始属性派生而来的。
- `缓慢变化维度处理`：维度表通常需要考虑缓慢变化维度（Slowly Changing Dimensions，SCD）的处理，以管理维度数据的变化。不同的SCD类型（如SCD1、SCD2）可以应用于维度表，以满足业务需求和数据历史追溯的要求。
- `可更新性`：维度表通常是一个只读的表，用于存储静态的描述性属性。在数据仓库中的ETL过程负责将源系统中的数据转换和加载到维度表中。
维度表的设计和建模需要考虑业务需求、数据分析的灵活性以及性能优化等因素。它提供了用于解释和分析事实表中度量数据的上下文信息，为数据仓库用户提供了丰富的维度分析能力。通过与事实表的关联，维度表支持复杂的查询、切片和钻取操作，从而支持业务决策和分析的需求。

## 财务预提
### 1. 什么是财务预提？
财务预提是指在财务报表中，为了符合会计准则，而在当期已发生但尚未确认的费用或收入，通过预提的方式，提前计入当期的费用或收入，从而使当期的财务报表更加准确。
### 2. 举例说明
假设某公司在2019年12月31日，已经发生了2019年12月份的工资费用，但是由于工资发放时间的原因，工资费用尚未确认，那么在2019年12月31日，公司就需要通过预提的方式，将2019年12月份的工资费用计入2019年的费用，从而使2019年的财务报表更加准确。

## Internal Order
### 1. 什么是内部订单？
内部订单是指在SAP系统中，用于跟踪和监控公司内部的成本和收入的订单，它可以用于跟踪和监控公司内部的成本和收入，也可以用于跟踪和监控公司内部的投资项目。
- 项目成本控制：内部订单可用于跟踪特定项目的成本和支出。这使得管理层能够准确评估项目的财务状况，及时进行预算控制和决策。
- 部门成本分配：内部订单可以用于将成本和费用分配给组织中的不同部门或成本中心。这有助于了解每个部门的运营成本，评估其绩效，并进行资源优化。
- 活动成本追踪：内部订单可用于追踪特定活动或业务过程的成本和效益。这有助于识别成本效益低下的活动，并进行改进和优化。

## 成本中心
1. 成本中心是指企业内部的一个组织单位、部门或区域，用于追踪和管理特定的成本和费用。它是成本管理的一个重要概念，旨在帮助企业了解和控制不同业务活动的成本。
2. 成本中心可以是一个部门，如销售部门、生产部门、人力资源部门等，也可以是一个特定的项目、产品线或地理位置。每个成本中心通常与特定的管理责任人和预算相关联。
3. 通过设立成本中心，企业可以更好地了解不同部门或业务活动的成本和开支情况。成本中心通常会记录和追踪与该部门相关的直接费用（如工资、材料费用）和间接费用（如租金、设备折旧、行政费用）。这样，企业可以更好地评估每个成本中心的绩效和效益，并采取相应的管理措施。
### 成本中心的设置和管理有助于实现以下目标：
- 成本控制：通过追踪和监控成本中心的费用，企业可以更好地控制和管理成本，识别潜在的成本节约机会。
- 绩效评估：成本中心的设置使企业能够评估各个部门或业务活动的绩效。通过比较实际成本和预算成本，可以确定绩效差异，并采取适当的措施进行改进。
- 决策支持：成本中心提供了可靠的数据和信息，支持管理层在做出决策时考虑成本因素。它可以帮助管理层识别哪些部门或活动对企业贡献最大，以及哪些部门需要改善和优化。

总之，成本中心是企业内部用于追踪、管理和控制特定成本和费用的单位或部门，有助于企业进行成本管理、绩效评估和决策支持。


